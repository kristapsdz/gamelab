<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@@htdocs@@/style.css" type="text/css" />
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
		<script src="@@htdocs@@/script.js"></script>
		<script src="@@cgibin@@/home.js"></script>
		<script>
			function onLoad() 
			{
				var url = document.URL;

				url = url.substring(0, url.lastIndexOf("/"));
				url = url.replace('admin', 'lab');
				document.getElementById('loginURI').value = url + '/dologin.html';
			}
		</script>
	</head>
	<body onload="onLoad(); loadNewGames(); loadNewPlayers(); loadSmtp();">
		<header>
			<a id="navButton" href="#" onclick="onNav(); return false;"><i class="fa fa-navicon"></i></a>
			<h1>gamelab</h1>
			<div id="exprCountdown">Not started</div>
		</header>
		<div id="navParent">
			<nav id="nav">
				<ul>
					<li><a href="@@cgibin@@/dologout.html"><i class="fa fa-sign-out"></i> Logout</a></li>
				</ul>
			</nav>
		</div>
		<article>
			<section>
				<aside>
					To deploy a <span class="name">gamelab</span> experiment, follow these steps.
					<ol>
						<li>
							Change your <a href="#changePassSection">password</a> and <a href="#changeMailSection">mail</a>.
						</li>
						<li>
							Add your experiment <a href="#addGameSection">games</a>.
						</li>
						<li>
							Add any experiment <a href="#addPlayersSection">participants</a>.
						</li>
						<li>
							Configure your <a href="#changeSmtpSection">SMTP</a> settings.
						</li>
						<li>
							<a href="#startExprSection">Deploy</a> your experiment.
						</li>
					</ol>
				</aside>
				<section id="startExprSection">
					<h3>Experiment Parameters</h3>
					<aside>
						<div>
							Commit your experiment parameters and start here.
							Once you start your experiment, you cannot change these.
							Checklist:
						</div>
						<ol>
							<li>
								Entered <a href="#changeSmtpSection">SMTP</a> data? 
								<i id="checkSmtpLoad" class="fa fa-spinner fa-spin"></i>
							</li>
							<li>
								Entered 2+ enabled <a href="#addPlayersSection">players</a>? 
								<i id="checkPlayersLoad" class="fa fa-spinner fa-spin"></i>
							</li>
							<li>
								Entered 1+ <a href="#addGameSection">games</a>? 
								<i id="checkGameLoad" class="fa fa-spinner fa-spin"></i>
							</li>
						</ol>
					</aside>
					<form action="@@cgibin@@/dostartexpr.json" method="post" id="startExpr" onsubmit="return(startExpr(this));">
						<div class="error">
							<div class="noshow" id="startExprErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="startExprErrForm">
								Can't start: start date in the past, not enough days, or no participants or games.
							</div>
							<div class="noshow" id="startExprErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-link"></i>
								<input required="required" id="loginURI" type="url" name="uri" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-calendar"></i>
								<input required="required" type="date" name="date" placeholder="yyyy-mm-dd" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-clock-o"></i>
								<input required="required" type="time" name="time" placeholder="hh:mm" /> GMT
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="number" name="rounds" min="1" step="1" value="14" />
								rounds
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="number" name="minutes" max="1440" min="1" step="1" value="1440" />
								minutes
							</div>
							<div class="input input-submit">
								<i class="fa fa-check"></i>
								<input id="startExprSubmit" type="submit" value="Start" />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
			<section>
				<section id="addGameSection">
					<h3>Games</h3>
					<aside>
						The following are your games.
						To delete a game, click the <i class="fa fa-remove"></i> symbol alongside.
					</aside>
					<ul id="loadGames">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<aside>
						You may add games by specifying a name and payoffs.
						Payoffs must follow the usual top-left to bottom-right order, one payoff per player (row player first).
					</aside>
					<form action="@@cgibin@@/doaddgame.json" method="post" id="addGame" onsubmit="return(addGame(this));">
						<div class="error">
							<div class="noshow" id="addGameErrSystem">
								An unexpected system error occurred.
							</div>
							<div class="noshow" id="addGameErrForm">
								Invalid game payoffs, name, or strategy count.
							</div>
							<div class="noshow" id="addGameErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-bars"></i>
								<input required="required" type="number" min="2" step="1" name="p1" value="2"/>
								rows
							</div>
							<div class="input">
								<i class="fa fa-fw fa-columns"></i>
								<input required="required" type="number" min="2" step="1" name="p2" value="2"/>
								columns
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="name" placeholder="Game Name"/>
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="payoffs" placeholder="Space-separated values (top-left to bottom-right)"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addGameSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="addPlayersSection">
					<h3>Players</h3>
					<aside>
						Players in your experiment.
						To delete a player, just click the <i class="fa fa-remove"></i> symbol alongisde.
					</aside>
					<ul id="loadNewPlayers">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<aside>
						Add players to the game using this form.
						Players consist of e-mail addresses separated by white-space (newlines, tabs, spaces, whatever).
						Players will not be contacted until you start the game.
					</aside>
					<form action="@@cgibin@@/doaddplayers.json" method="post" id="addPlayers" onsubmit="return(addPlayers(this));">
						<div class="error">
							<div class="noshow" id="addPlayersErrSystem">
								An unexpected system error occurred.
							</div>
							<div class="noshow" id="addPlayersErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-users"></i>
								<textarea required="required" name="players" placeholder="Space-separated player e-mail addresses..."></textarea>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addPlayersSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeMailSection">
					<h3>Change E-mail</h3>
					<aside>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangemail.json" method="post" id="changeMail" onsubmit="return(changeMail(this));">
						<div class="error">
							<div class="noshow" id="changeMailErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeMailErrForm">
								Invalid new or existing e-mail address.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email1" placeholder="Existing E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email2" placeholder="New E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeMailSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changePassSection">
					<h3>Change Password</h3>
					<aside>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangepass.json" method="post" id="changePass" onsubmit="return(changePass(this));">
						<div class="error">
							<div class="noshow" id="changePassErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changePassErrForm">
								Invalid new or existing password.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password1" placeholder="Existing Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password2" placeholder="New Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password3" placeholder="Repeat New Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changePassSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeSmtpSection">
					<h3>Change SMTP</h3>
					<aside>
						In order to send e-mails to players, you need to configure a valid e-mail sending
						service.
						If you mess up, you can always fix this information after the game starts and re-try e-mails
						that failed to send.
					</aside>
					<div id="checkSmtpResults" class="noshow">
						<h4>Current Values</h4>
						<aside>
							<div>
								The following are your SMTP parameters.
								Click <q>Send Test</q> to send a test message to the administrator account
								(<em>not</em> the <q>from address</q>!).
							</div>
						</aside>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input disabled="disabled" id="checkSmtpResultsServer" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input disabled="disabled" id="checkSmtpResultsUser" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input disabled="disabled" id="checkSmtpResultsFrom" type="text" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-send"></i>
								<button type="button" class="send" id="checkSmtpButton" onclick="testSmtp();">Send Test</button>
							</div>
						</fieldset>
					</div>
					<div id="testSmtpResults" class="noshow canclose">
						<h4>Results</h4>
						<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
						A test e-mail has been sent to <span id="testSmtpResultsMail"></span>.
						If you do not receive it in a little while, please fix your mail settings.
					</div>
					<div id="checkSmtpResultsNone" class="noshow error">
						<i class="fa fa-warning"></i>
						<span>You have not yet configured your e-mail server.</span>
					</div>
					<div id="checkSmtpResultsLoad">
						<i class="fa fa-spinner fa-spin"></i>
					</div>
					<aside>
						<div>
							The e-mail address <i class="fa fa-envelope"></i> will appear as the <q>from</q> address
							on all e-mails the system sends out.
							Make sure this is a real address so participants can write to you!
							The server <i class="fa fa-database"></i> is your SMTP server.
							It must be encrypted (SSL/TLS), and be in the form
							<q>smtp://the.server.name:port</q>, where the port is usually 25, 465, or 587.
							(It can be anything, though.)
							The username <i class="fa fa-user"></i> and password <i class="fa fa-lock"></i> are used
							to log into your server.
							<em>Your password is stored on the gamelab server</em>:
							make sure it's something random and not used elsewhere!
						</div>
					</aside>
					<form action="@@cgibin@@/dochangesmtp.json" method="post" id="changeSmtp" onsubmit="return(changeSmtp(this));">
						<div class="error">
							<div class="noshow" id="changeSmtpErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeSmtpErrForm">
								Invalid new or existing parameters.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email" placeholder="you@example.com"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input required="required" type="text" name="server" placeholder="smtp://example.com:587"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input required="required" type="text" name="user" placeholder="SMTP User"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password" placeholder="SMTP Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeSmtpSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@@htdocs@@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
