<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@@cgibin@@/style.css" type="text/css" />
		<script src="@@htdocs@@/script.js"></script>
		<script src="@@cgibin@@/home.js"></script>
	</head>
	<body onload="loadGames(); loadNewPlayers(); loadSmtp();">
		<header>
			<nav>
				<ul>
					<li><h1>Administrator</h1></li>
					<li><a href="@@cgibin@@/dologout.html">Logout</a></li>
				</ul>
			</nav>
		</header>
		<article>
			<section>
				<aside>
					To deploy a <span class="name">gamelab</span> experiment, follow these steps.
					<ol>
						<li>
							Change your <a href="#changePassSection">password</a> and <a href="#changeMailSection">e-mail</a>.
						</li>
						<li>
							Add your experiment <a href="#addGameSection">games</a>.
						</li>
						<li>
							Add any experiment <a href="#addPlayersSection">participants</a>.
						</li>
						<li>
							Configure your <a href="#changeSmtpSection">SMTP</a> settings.
						</li>
						<li>
							<a href="#startExprSection">Deploy</a> your experiment.
						</li>
					</ol>
				</aside>
				<form action="@@cgibin@@/dostartexpr.json" method="post" id="startExpr" onsubmit="return(sendForm(this, doStartExprSetup, doStartExprError, doStartExprSuccess));">
					<section id="startExprSection">
						<h3>Experiment Parameters</h3>
						<div class="error">
							<div style="display: none;" id="startExprErrSystem">An unexpected error occurred.</div>
							<div style="display: none;" id="startExprErrForm">Can't start: start date in the past, not enough days, or no participants or games.</div>
							<div style="display: none;" id="startExprErrState">Experiment already started!</div>
						</div>
						<aside>
							<div>
								Commit your experiment parameters and start here.
								Once you start your experiment, you cannot add or remove games or players.
							</div>
							<div>
								Checklist:
							</div>
							<ol>
								<li>
									Entered <a href="#changeSmtp">SMTP</a> data? 
									<span><span class="loading" id="checkSmtpLoad">Loading...</span></span>
									<span><img style="display: none;" id="checkSmtpYes" src="@@htdocs@@/accept.png" class="status" alt="Yes" /></span>
									<span><img style="display: none;" id="checkSmtpNo" src="@@htdocs@@/block.png" class="status" alt="No" /></span>
								</li>
								<li>
									Entered 2+ enabled <a href="#addPlayers">players</a>? 
									<span><span class="loading" id="checkPlayersLoad">Loading...</span></span>
									<span><img style="display: none;" id="checkPlayersYes" src="@@htdocs@@/accept.png" class="status" alt="Yes" /></span>
									<span><img style="display: none;" id="checkPlayersNo" src="@@htdocs@@/block.png" class="status" alt="No" /></span>
								</li>
								<li>
									Entered 1+ <a href="#addGame">games</a>? 
									<span><img src="@@htdocs@@/ajax-loader.gif" id="checkGameLoad" class="loader" alt="Checking..." /></span>
									<span><img style="display: none;" id="checkGameYes" src="@@htdocs@@/accept.png" class="status" alt="Yes" /></span>
									<span><img style="display: none;" id="checkGameNo" src="@@htdocs@@/block.png" class="status" alt="No" /></span>
								</li>
							</ol>
						</aside>
						<fieldset>
							<div><input required="required" type="text" name="uri" placeholder="http://lab/loginpage.html" /></div>
							<div>
								<input required="required" type="date" name="date" placeholder="yyyy-mm-dd" />
								for
								<input required="required" type="number" name="days" min="1" step="1" value="14" />
								days
							</div>
							<div><input id="startExprSubmit" type="submit" value="Start" /></div>
						</fieldset>
					</section>
				</form>
			</section>
			<section>
				<section id="addGameSection">
					<h3>Games</h3>
					<aside>
						The games themselves.
					</aside>
					<ul id="loadGames">
						<li><img src="@@htdocs@@/ajax-loader.gif" class="loader" alt="Loading..." />Loading...</li>
					</ul>
					<form action="@@cgibin@@/doaddgame.json" method="post" id="addGame" 
						onsubmit="return(sendForm(this, doAddGameSetup, doAddGameError, doAddGameSuccess));">
						<div class="error">
							<div style="display: none;" id="addGameErrSystem">An unexpected system error occurred.</div>
							<div style="display: none;" id="addGameErrForm">Invalid game payoffs, name, or strategy count.</div>
							<div style="display: none;" id="addGameErrState">Experiment already started!</div>
						</div>
						<fieldset>
							<div>
								<label>Strategy rows</label>
								<input required="required" type="number" min="2" step="1" name="p1" value="2"/>,
								<label>columns</label>
								<input required="required" type="number" min="2" step="1" name="p2" value="2"/>
							</div>
							<div><input required="required" type="text" name="name" placeholder="Game Name"/></div>
							<div><input required="required" type="text" name="payoffs" placeholder="Space-separated values (top-left to bottom-right)"/></div>
							<div><input id="addGameSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
				<section id="addPlayersSection">
					<h3>Players</h3>
					<aside>
						Players in your experiment.
						To delete a player, just click the red symbol alongisde.
					</aside>
					<ul id="loadNewPlayers">
						<li><img src="@@htdocs@@/ajax-loader.gif" class="loader" alt="Loading..." />Loading...</li>
					</ul>
					<form action="@@cgibin@@/doaddplayers.json" method="post" id="addPlayers" 
						onsubmit="return(sendForm(this, doAddPlayersSetup, doAddPlayersError, doAddPlayersSuccess));">
						<div class="error">
							<div style="display: none;" id="addPlayersErrSystem">An unexpected system error occurred.</div>
							<div style="display: none;" id="addPlayersErrState">Experiment already started!</div>
						</div>
						<aside>
							Add players to the game using this form.
							Players consist of e-mail addresses separated by white-space (newlines, tabs, spaces, whatever).
							Players will not be contacted until you start the game.
						</aside>
						<fieldset>
							<div><textarea required="required" name="players" placeholder="Space-separated player e-mail addresses..."></textarea></div>
							<div><input id="addPlayersSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
			</section>
			<section>
				<section id="changeMailSection">
					<h3>Change E-mail</h3>
					<aside>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangemail.json" method="post" id="changeMail" 
						onsubmit="return(sendForm(this, doChangeMailSetup, doChangeMailError, doChangeMailSuccess));">
						<div class="error">
							<div style="display: none;" id="changeMailErrSystem">An unexpected error occurred.</div>
							<div style="display: none;" id="changeMailErrForm">Invalid new or existing e-mail address.</div>
						</div>
						<fieldset>
							<div><input required="required" type="email" name="email1" placeholder="Existing E-mail"/></div>
							<div><input required="required" type="email" name="email2" placeholder="New E-mail"/></div>
							<div><input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/></div>
							<div><input id="changeMailSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
				<section id="changePassSection">
					<h3>Change Password</h3>
					<aside>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangepass.json" method="post" id="changePass" 
						onsubmit="return(sendForm(this, doChangePassSetup, doChangePassError, doChangePassSuccess));">
						<div class="error">
							<div style="display: none;" id="changePassErrSystem">An unexpected error occurred.</div>
							<div style="display: none;" id="changePassErrForm">Invalid new or existing password.</div>
						</div>
						<fieldset>
							<div><input required="required" type="password" name="password1" placeholder="Existing Password"/></div>
							<div><input required="required" type="password" name="password2" placeholder="New Password"/></div>
							<div><input required="required" type="password" name="password3" placeholder="Repeat New Password"/></div>
							<div><input id="changePassSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
				<section id="changeSmtpSection">
					<h3>Change SMTP</h3>
					<aside>
						In order to send e-mails to players, you need to configure a valid e-mail sending service.
						Fill in the <q>From Address</q> (which appears on all e-mails to players),
						<q>SMTP Server</q> to a valid SSL-secured SMTP server,
						<q>SMTP User</q> to the your server account name, and
						<q>SMTP Password</q> to the your user's password.
						<div id="checkSmtpResultsLoad">
							<span class="loading">Loading...</span>
						</div>
						<div id="checkSmtpResults" style="display: none;">
						</div>
					</aside>
					<form action="@@cgibin@@/dochangesmtp.json" method="post" id="changeSmtp" 
						onsubmit="return(sendForm(this, doChangeSmtpSetup, doChangeSmtpError, doChangeSmtpSuccess));">
						<div class="error">
							<div style="display: none;" id="changeSmtpErrSystem">An unexpected error occurred.</div>
							<div style="display: none;" id="changeSmtpErrForm">Invalid new or existing parameters.</div>
						</div>
						<fieldset>
							<div><input required="required" type="email" name="email" placeholder="you@example.com"/></div>
							<div><input required="required" type="text" name="server" placeholder="smtp://example.com:587"/></div>
							<div><input required="required" type="text" name="user" placeholder="SMTP User"/></div>
							<div><input required="required" type="password" name="password" placeholder="SMTP Password"/></div>
							<div><input id="changeSmtpSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@@htdocs@@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
