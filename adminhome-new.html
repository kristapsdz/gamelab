<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@@htdocs@@/style.css" type="text/css" />
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
		<script src="@@htdocs@@/script.js"></script>
		<script src="@@cgibin@@/home.js"></script>
		<script>
			/*
			 * Replace the "login URL" identified in the
			 * experiment start section with the current URL
			 * having its admin bits replaced with lab bits.
			 */
			function onLoad() 
			{
				var url = document.URL;
				var e = document.getElementById('loginURI');

				if (null == e || null == url)
					return;

				url = url.substring(0, url.lastIndexOf("/"));
				url = url.replace('admin', 'lab');
				e.value = url + '/dologin.html';
			}
		</script>
	</head>
	<body onload="onLoad(); loadNewGames(); loadNewPlayers(); loadSmtp();" onclick="onNavUp();">
		<header>
			<a id="navButton" href="#" onclick="return(onNav(event));"><i class="fa fa-navicon"></i></a>
			<h1>gamelab</h1>
			<div id="exprCountdown">Not started</div>
		</header>
		<div id="navParent">
			<nav id="nav">
				<ul>
					<li><a href="@@cgibin@@/dologout.html"><i class="fa fa-sign-out"></i> Logout</a></li>
				</ul>
			</nav>
		</div>
		<article>
			<p>
				To deploy a <span class="name">gamelab</span> experiment, follow these steps.
				</p>
			<ol>
				<li>
					Change your <a href="#changePassSection">password</a> and <a href="#changeMailSection">mail</a>.
				</li>
				<li>
					Add your experiment <a href="#addGameSection">games</a>.
				</li>
				<li>
					Add any experiment <a href="#addPlayersSection">participants</a>.
				</li>
				<li>
					Configure your <a href="#changeSmtpSection">SMTP</a> settings.
				</li>
				<li>
					<a href="#startExprSection">Deploy</a> your experiment.
				</li>
			</ol>
			<section>
				<section id="startExprSection">
					<h3>Experiment Parameters</h3>
					<aside>
						<div>
							Commit your experiment parameters and start here.
							Once you start your experiment, you cannot change these.
							Checklist:
						</div>
						<ol>
							<li>
								Entered <a href="#changeSmtpSection">SMTP</a> data? 
								<i id="checkSmtpLoad" class="fa fa-spinner fa-spin"></i>
							</li>
							<li>
								Entered 2+ enabled <a href="#addPlayersSection">players</a>? 
								<i id="checkPlayersLoad" class="fa fa-spinner fa-spin"></i>
							</li>
							<li>
								Entered 1+ <a href="#addGameSection">games</a>? 
								<i id="checkGameLoad" class="fa fa-spinner fa-spin"></i>
							</li>
						</ol>
						<div>
							You'll need to enter the <i class="fa fa-link"></i> address for logging in (sent in players'
							welcome email &mdash; you probably don't want to change this), the <i class="fa
								fa-calendar"></i> start date and <i class="fa fa-clock-o"></i> time in GMT, the
							number of rounds, and the minutes per round.
							You can also change the <i class="fa fa-code"></i> instructions (in HTML5 markup) that
							will be shown to players.
						</div>
					</aside>
					<form action="@@cgibin@@/dostartexpr.json" method="post" id="startExpr" onsubmit="return(startExpr(this));">
						<div class="error">
							<div class="noshow" id="startExprErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="startExprErrForm">
								Can't start: start date in the past, not enough days, or no participants or games.
							</div>
							<div class="noshow" id="startExprErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-link"></i>
								<input required="required" id="loginURI" type="url" name="uri" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-calendar"></i>
								<input required="required" type="date" name="date" placeholder="yyyy-mm-dd" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-clock-o"></i>
								<input required="required" type="time" name="time" placeholder="hh:mm" /> GMT
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="number" name="rounds" min="1" step="1" value="14" />
								rounds
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="number" name="minutes" max="1440" min="1" step="1" value="1440" />
								minutes
							</div>
							<div class="input">
								<i class="fa fa-fw fa-code"></i>
								<textarea class="bigtext" required="required" name="instructions"><p>
Thank you for participating in this experiment. The aim of the study is to investigate how different theoretical economic predictions perform when subjected to real decisions.
</p>
<p>
On this page you will find all the information you need to participate, feel free to contact @@gamelab-admin-email@@ if you have any additional questions.
</p>
<h3>Game Setup</h3>
<p>
The experiment will run for five rounds, where each round is 24 hours long. In each round you will play five games. These games will be the same in all rounds. At the end of each round your earnings from that round will be calculated based on your and the other players' actions, and a new round will begin.
</p>
<p>
To get any payoffs from a round you have to finish all five games.
</p>
<h3>How to Play</h3>
<p>
Each game is represented in a <i>game matrix</i>. This matrix represents the strategies available to players as rows and columns. There are two corresponding player roles, one choosing rows and one choosing columns. In all games you are a row player.
</p>
<p>
In the game matrix outcomes, corresponding to a selection of a row and a column, are represented as cells. Each cell contains two numbers, the first colored in @@gamelab-own-colour@@ represents your payoff and the second colored in @@game-other-colour@@ represents the column player's payoff.
</p>
<p>
You select which strategies to play (rows since you are a row player) and assign a probability to each of them. These probabilities have to sum to 1 since you always have to play some row. The column players select column strategies in the same manner. Just as you will not know what they have chosen in the current round they are not informed of your decision when they choose.
</p>
<p>
To select which strategies to play you click on rows in the game matrix. When you have selected all strategies you want to assign probabilities to you have to do so in the corresponding fields below the matrix. Any strategy you have not selected will be played with probability 0. Note that you can select more than one strategy and assign probabilities between 0 and 1 to them if you should want.
</p>
<p>
When you have selected which strategies to play and assigned probabilities to them you click the <q>Submit Play</q> button to submit your probabilities.
</p>
<h3>Payoffs</h3>
<p>
After each round has finished the payoffs of each of the five games are calculated by taking the strategy you played and taking the expected payoff against the average of the column players' strategies in the previous round. See the matrix below for an example:
</p>
<table>
 <tr><td></td><td>a.</td><td>b.</td></tr>
 <tr><td>1.</td><td>1 1</td><td>0 0</td></tr>
 <tr><td>2.</td><td>0 0</td><td>1 1</td></tr>
</table>
<p>
If you played 1. with probability 0.6 and 2. with probability 0.4 while the column players chose a. with probability 0.8 and b. with probability 0.2 your payoff in this game and round is (from top left to bottom right):
</p>
<p style="text-align: center;">
0.6 * 0.8 * 1 + 0.6 * 0.2 * 0 + 0.4 * 0.8 * 0 + 0.4 * 0.2 * 1 = 0.56
</p>
<p>
All payoffs in this experiment represent lottery tickets. 1 payoff unit equals 1 lottery ticket. When all rounds are finished and your total number of payoff units across games and rounds have been calculated we will round this number up to the closest integer in order to get your total number of tickets.
</p>
<p>
All of your tickets will be represented by a number. If for example a total number of 100 lottery tickets have been awarded to all players and you have earned 10 of them, you might have tickets 41&ndash;50. This information will be given after the final round has ended.
</p>
<h3>Lottery Prices</h3>
<p>
The prices in the lottery are:
</p>
<p>
1st price: 8 000kr
<br />
2<sup>nd</sup>&ndash;5<sup>th</sup> prices: 500kr
</p>
<h3>History</h3>
<p>
For all rounds but the first you will be presented with a history of how players played in previous rounds. This history is a weighted average of previous play which places more weight on more recent rounds. Note that while the history shows what has happened before, it does not give any information on how players have played in the current round, which is what is used for calculating payoffs.
</p>
<p>
The history is presented in a matrix corresponding to the game. For example, if both your own and the other player roles have two strategies the history matrix will have four cells representing the probabilities that each combination was played. Additionally, probabilities outside the matrix represent the probabilities that each player role chose that strategy. See below for an example:
</p>
<table>
 <tr><td></td><td>a.</td><td>b.</td><td>Sum</td></tr>
 <tr><td>1.</td><td>1 1</td><td>0 0</td><td>0.5</td></tr>
 <tr><td>2.</td><td>0 0</td><td>1 1</td><td>0.5</td></tr>
 <tr><td>Sum</td><td>0.5</td><td>0.5</td></tr>
</table>
<p>
The history in this matrix shows that the probability that any strategy was played is exactly one half, as would happen if all players randomized equally or if half of the players in each role chose one strategy and the other half chose the other. This in turn means that any strategy combination (for example 1. and a.) will be played with probability 0.5*0.5=0.25.
</p>
<p>
You can view the history for each of the five games on the <q>History</q> tab as well as viewing it alongside each game in the round.
</p>
								</textarea>
							</div>
							<div class="input input-submit">
								<i class="fa fa-check"></i>
								<input id="startExprSubmit" type="submit" value="Start" />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
			<section>
				<section id="addGameSection">
					<h3>Games</h3>
					<aside>
						The following are your games.
						To delete a game, click the <i class="fa fa-remove"></i> symbol alongside.
					</aside>
					<ul id="loadGames">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<aside>
						You may add games by specifying a name and payoffs.
						Payoffs must follow the usual top-left to bottom-right order, one payoff per player (row player first).
					</aside>
					<form action="@@cgibin@@/doaddgame.json" method="post" id="addGame" onsubmit="return(addGame(this));">
						<div class="error">
							<div class="noshow" id="addGameErrSystem">
								An unexpected system error occurred.
							</div>
							<div class="noshow" id="addGameErrForm">
								Invalid game payoffs, name, or strategy count.
							</div>
							<div class="noshow" id="addGameErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-bars"></i>
								<input required="required" type="number" min="2" step="1" name="p1" value="2"/>
								rows
							</div>
							<div class="input">
								<i class="fa fa-fw fa-columns"></i>
								<input required="required" type="number" min="2" step="1" name="p2" value="2"/>
								columns
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="name" placeholder="Game Name"/>
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="payoffs" placeholder="Space-separated values (top-left to bottom-right)"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addGameSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="addPlayersSection">
					<h3>Players</h3>
					<aside>
						Players in your experiment.
						To delete a player, just click the <i class="fa fa-remove"></i> symbol alongisde.
					</aside>
					<ul id="loadNewPlayers">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<aside>
						Add players to the game using this form.
						Players consist of e-mail addresses separated by white-space (newlines, tabs, spaces, whatever).
						Players will not be contacted until you start the game.
					</aside>
					<form action="@@cgibin@@/doaddplayers.json" method="post" id="addPlayers" onsubmit="return(addPlayers(this));">
						<div class="error">
							<div class="noshow" id="addPlayersErrSystem">
								An unexpected system error occurred.
							</div>
							<div class="noshow" id="addPlayersErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-users"></i>
								<textarea required="required" name="players" placeholder="Space-separated player e-mail addresses..."></textarea>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addPlayersSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeMailSection">
					<h3>Change E-mail</h3>
					<aside>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangemail.json" method="post" id="changeMail" onsubmit="return(changeMail(this));">
						<div class="error">
							<div class="noshow" id="changeMailErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeMailErrForm">
								Invalid new or existing e-mail address.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email1" placeholder="Existing E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email2" placeholder="New E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeMailSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changePassSection">
					<h3>Change Password</h3>
					<aside>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangepass.json" method="post" id="changePass" onsubmit="return(changePass(this));">
						<div class="error">
							<div class="noshow" id="changePassErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changePassErrForm">
								Invalid new or existing password.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password1" placeholder="Existing Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password2" placeholder="New Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password3" placeholder="Repeat New Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changePassSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeSmtpSection">
					<h3>Change SMTP</h3>
					<aside>
						In order to send e-mails to players, you need to configure a valid e-mail sending
						service.
						If you mess up, you can always fix this information after the game starts and re-try e-mails
						that failed to send.
					</aside>
					<div id="checkSmtpResults" class="noshow">
						<h4>Current Values</h4>
						<aside>
							<div>
								The following are your SMTP parameters.
								Click <q>Send Test</q> to send a test message to the administrator account
								(<em>not</em> the <q>from address</q>!).
							</div>
						</aside>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input disabled="disabled" id="checkSmtpResultsServer" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input disabled="disabled" id="checkSmtpResultsUser" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input disabled="disabled" id="checkSmtpResultsFrom" type="text" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-send"></i>
								<button type="button" class="send" id="checkSmtpButton" onclick="testSmtp();">Send Test</button>
							</div>
						</fieldset>
					</div>
					<div id="testSmtpResults" class="noshow canclose">
						<h4>Results</h4>
						<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
						A test e-mail has been sent to <span id="testSmtpResultsMail"></span>.
						If you do not receive it in a little while, please fix your mail settings.
					</div>
					<div id="checkSmtpResultsNone" class="noshow error">
						<i class="fa fa-warning"></i>
						<span>You have not yet configured your e-mail server.</span>
					</div>
					<div id="checkSmtpResultsLoad">
						<i class="fa fa-spinner fa-spin"></i>
					</div>
					<aside>
						<div>
							The e-mail address <i class="fa fa-envelope"></i> will appear as the <q>from</q> address
							on all e-mails the system sends out.
							Make sure this is a real address so participants can write to you!
							The server <i class="fa fa-database"></i> is your SMTP server.
							It must be encrypted (SSL/TLS), and be in the form
							<q>smtp://the.server.name:port</q>, where the port is usually 25, 465, or 587.
							(It can be anything, though.)
							The username <i class="fa fa-user"></i> and password <i class="fa fa-lock"></i> are used
							to log into your server.
							<em>Your password is stored on the gamelab server</em>:
							make sure it's something random and not used elsewhere!
						</div>
					</aside>
					<form action="@@cgibin@@/dochangesmtp.json" method="post" id="changeSmtp" onsubmit="return(changeSmtp(this));">
						<div class="error">
							<div class="noshow" id="changeSmtpErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeSmtpErrForm">
								Invalid new or existing parameters.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email" placeholder="you@example.com"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input required="required" type="text" name="server" placeholder="smtp://example.com:587"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input required="required" type="text" name="user" placeholder="SMTP User"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password" placeholder="SMTP Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeSmtpSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@@htdocs@@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
