<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@@htdocs@@/style.css" type="text/css" />
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
		<script src="@@htdocs@@/script.js"></script>
		<script src="@@cgibin@@/home.js"></script>
		<script>
			/*
			 * Replace the "login URL" identified in the
			 * experiment start section with the current URL
			 * having its admin bits replaced with lab bits.
			 */
			function onLoad() 
			{
				var url = document.URL;
				var e = document.getElementById('loginURI');

				if (null == e || null == url)
					return;

				url = url.substring(0, url.lastIndexOf("/"));
				url = url.replace('admin', 'lab');
				e.value = url + '/dologin.html';
			}
		</script>
	</head>
	<body onload="onLoad(); loadNewGames(); loadNewPlayers(); loadSmtp();" onclick="onNavUp();">
		<header>
			<a id="navButton" href="#" onclick="return(onNav(event));"><i class="fa fa-navicon"></i></a>
			<h1>gamelab</h1>
			<div id="exprCountdown">Not started</div>
			<div id="navParent">
				<nav id="nav">
					<ul>
						<li><a href="@@cgibin@@/dologout.html"><i class="fa fa-sign-out"></i> Logout</a></li>
					</ul>
				</nav>
			</div>
		</header>
		<article>
			<p>
				To deploy a <span class="name">gamelab</span> experiment, follow these steps.
			</p>
			<ol>
				<li>
					Change your <a href="#changePassSection">password</a> and <a href="#changeMailSection">mail</a>.
				</li>
				<li>
					Add your experiment <a href="#addGameSection">games</a>.
				</li>
				<li>
					Add any experiment <a href="#addPlayersSection">participants</a>.
				</li>
				<li>
					Configure your <a href="#changeSmtpSection">SMTP</a> settings.
				</li>
				<li>
					<a href="#startExprSection">Deploy</a> your experiment.
				</li>
			</ol>
			<section>
				<section id="startExprSection">
					<h3>Experiment Parameters</h3>
					<aside>
						<div>
							Commit your experiment parameters and start here.
							Once you start your experiment, you cannot change these.
							Checklist:
						</div>
						<ol>
							<li>
								Entered <a href="#changeSmtpSection">SMTP</a> data? 
								<i id="checkSmtpLoad" class="fa fa-spinner fa-spin"></i>
							</li>
							<li>
								Entered 2+ enabled <a href="#addPlayersSection">players</a>? 
								<i id="checkPlayersLoad" class="fa fa-spinner fa-spin"></i>
							</li>
							<li>
								Entered 1+ <a href="#addGameSection">games</a>? 
								<i id="checkGameLoad" class="fa fa-spinner fa-spin"></i>
							</li>
						</ol>
						<div>
							You'll need to enter the <i class="fa fa-link"></i> address for logging in (sent in players'
							welcome email &mdash; you probably don't want to change this), the <i class="fa
								fa-calendar"></i> start date and <i class="fa fa-clock-o"></i> time in GMT, the
							<i class="fa fa-gears"></i> number of rounds, and the <i class="fa fa-history"></i> minutes per round.
							You can also change the <i class="fa fa-code"></i> instructions (in HTML5 markup) that
							will be shown to players.
						</div>
					</aside>
					<form action="@@cgibin@@/dostartexpr.json" method="post" id="startExpr" onsubmit="return(startExpr(this));">
						<div class="error">
							<div class="noshow" id="startExprErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="startExprErrForm">
								Can't start: start date in the past, not enough days, or no participants or games.
							</div>
							<div class="noshow" id="startExprErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-link"></i>
								<input required="required" id="loginURI" type="url" name="uri" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-calendar"></i>
								<input required="required" type="date" name="date" placeholder="yyyy-mm-dd" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-clock-o"></i>
								<input required="required" type="time" name="time" placeholder="hh:mm GMT" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-gears"></i>
								<input required="required" type="number" name="rounds" min="1" step="1" value="14" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-history"></i>
								<input required="required" type="number" name="minutes" max="1440" min="1" step="1" value="1440" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-code"></i>
								<textarea id="instrText" class="bigtext" required="required" name="instr"><p>Welcome to the experiment!</p>

<p>You are participating in an economics experiment in which youâ€™ll use this webpage to play a number of games. Depending on your own and
others' choices you can earn a substantial amount of money through winning a lottery at the end of the experiment. Your chances to win the
lottery depends on how well you understand these instructions, so read them carefully.</p>
 
<p>On this page you will find all the information you need to participate, feel free to contact <a
	href="mailto:@@gamelab-admin-email@@">@@gamelab-admin-email@@</a> if you have any additional questions.</p>

<h3>Game setup</h3>
<p>The experiment will run for @@gamelab-rounds@@ rounds and each round lasts for @@gamelab-round-time@@ hours. In each of these rounds you will
play @@gamelab-games@@ games. The games will be the same in all rounds.</p>

<p>If you played all @@gamelab-games@@ games in a round your payoffs from that round are calculated as soon as the round is over. For each game
you can view your payoffs from the previous round directly on the play page where you play the games. A more detailed summary of your payoffs
for each game from all rounds along with the total sum of your payoffs is available on the <q>History</q> tab.

<h3>How to play</h3>

<p>Each game is represented in a <i>game bimatrix</i> where one player chooses row and the other column. The first number in each cell is your
payoffs and the second number is the other player's payoffs. You will always be the row player and your payoffs will always be <i
	id="playerColour2" class="fa fa-square"></i>uniquely coloured.  The other player's payoffs will always be <i id="playerOColour2" class="fa
	fa-square"></i>coloured.</p>

<p>When you play you may either select a pure strategy (one row) or a mixed strategy (a probability distribution over the rows). In the first
case you assign probability 1 to the row you want to play. In the second case you can select any probabilities you like, as long as they sum to
one. Your choice of strategies is your private information and will not be shared with any other participants.</p>

<p>When you have chosen a strategy (pure or mixed) to play, click on each row that is included in the strategy and assign the corresponding
probabilities in the input fields below. Any row which is not selected will not be played at all (played with probability 0).</p>

<p>When you have selected which strategy to play and assigned the corresponding probabilities to the rows click the <q>Submit Play</q> button to
proceed to the next game.</p>

<h3>Payoffs</h3>

<p>After each round your payoffs from each of the @@gamelab-games@@ games will be calculated.  For each game this is done by calculating the
average of the expected payoff of your strategy against each column player's strategy. Your final payoff from the round is simply the sum of
your expected payoff from each game. Your total payoff is the sum of your final payoff from all rounds. You can view this information at the
<q>History</q> tab at any time.</p>

<h3>Lottery tickets and prices</h3>

<p>All payoffs in this experiment represent lottery tickets. 1 payoff unit equals 1 lottery ticket. When all rounds are finished and your total
number of payoff units across games and rounds have been calculated we will round this number up to the closest integer in order to get your
total number of tickets.</p>

<p>All of your tickets will be represented by a number. If for example a total number of 100 lottery tickets have been awarded to all players
and you have earned 10 of them, you might have tickets 41-50. This information will be given after the final round has ended.</p>

<p>In order to decide the winning tickets we will use a quasi-random process in which the initial seed exactly determines the winning number.
The seed will however be the additional number from the first Lotto 1 draw after the final round (this number can be found at
https://svenskaspel.se/?pageid=/resultat/lottolordag). Since this number is completely random and out of our control the winning lottery ticket
is also truly random.</p>

<p>The calculator for drawing the winning lottery ticket can be tested below and will be able to use after the final round. After the final
round has ended you will be told which sequence of lottery tickets you have along with the total number of tickets that were awarded during the
experiment. As soon as the additional number from the Lotto 1 draw is announced you can check for yourself if you have the winning ticket. We
will also contact the winner shortly after the draw is announced.</p>

<p>The winner of the lottery will be awarded 10 000kr</p>

<h3>Weighted history of play</h3>

<p>For all rounds but the first you will be presented with a weighted history of how players in your own role (row players) and in the other
role (column players) played in previous rounds (more weight on more recent rounds). This information is presented as a frequency table which is
available to all players. This table is a summary of past play and does not incorporate play in the current round.</p>

<p>The weighted history is presented in a table corresponding to the game. For example, if both your own and the other player roles have two
strategies the frequency table will have four cells representing the probabilities that each combination was played. Additionally, probabilities
at the edge the frequency table represent the probabilities that each player role has chosen that row or column. See below for an example:</p>

<div class="history" style="max-width: 20em;">
  <div>
    <div style="width: 1%;" class="labelaside"></div>
    <div style="width: 32%;" class="labelatop">A</div>
    <div style="width: 32%;" class="labelatop">B</div>
    <div style="width: 32%;" class="sumaside"><span>&#x2211;</span><span>: E&#x27e6;</span><var>X</var><span>&#x27e7;</span></div>
  </div>
  <div>
    <div class="labelatop">a</div>
    <div class="mix">0.315</div>
    <div class="mix">0.585</div>
    <div class="sumaside sum"><span>0.900</span><span>: </span><span>X</span></div>
  </div>
  <div>
    <div class="labelatop">b</div>
    <div class="mix">0.035</div>
    <div class="mix">0.065</div>
    <div class="sumaside sum"><span>0.100</span><span>: </span><span>X</span></div>
  </div>
  <div>
    <div class="labelaside">&#x2211;</div>
    <div class="sumbelow sum">0.350</div>
    <div class="sumbelow sum">0.650</div>
    <div class="sumaside"></div>
  </div>
</div>

<p>From the frequency table we can conclude that, after weighting recent rounds more, the combination 1. and a. has been played 31.5% of the
times in the past while 2. and a. has been played 3.5% of the times. By looking at the sums at the edge of the table we see that players in your
player role (row) have played 1. 90% of the time and 2. 10% of the time, on average.</p>

<p>You can view current and past frequency tables for each of the five games on the <q>History</q> tab as well as viewing the current ones on
the play pages where you play the games.</p>
								</textarea>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-code"></i>
								<textarea id="instrWinText" required="required" name="instrWin">
You have been selected in the lottery.  Rank <span id="exprFinishedWinRank">ranknum</span>, random number <span id="exprFinishedWinRnum"></span>.
								</textarea>
							</div>
							<div class="input input-submit">
								<i class="fa fa-check"></i>
								<input id="startExprSubmit" type="submit" value="Start" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-check"></i>
								<button type="button" onclick="previewInstr();">Preview Instructions</button>
							</div>
							<div id="previewInstr" class="canclose noshow">
								<h4>Preview Instructions</h4>
								<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
								<div id="previewInstrInner">
								</div>
							</div>
						</fieldset>
					</form>
				</section>
			</section>
			<section>
				<section id="addGameSection">
					<h3>Games</h3>
					<aside>
						The following are your games.
						To delete a game, click the <i class="fa fa-remove"></i> symbol alongside.
					</aside>
					<ul id="loadGames">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<aside>
						You may add games by specifying a name and payoffs.
						Payoffs must follow the usual top-left to bottom-right order, one payoff per player (row player first).
					</aside>
					<form action="@@cgibin@@/doaddgame.json" method="post" id="addGame" onsubmit="return(addGame(this));">
						<div class="error">
							<div class="noshow" id="addGameErrSystem">
								An unexpected system error occurred.
							</div>
							<div class="noshow" id="addGameErrForm">
								Invalid game payoffs, name, or strategy count.
							</div>
							<div class="noshow" id="addGameErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-bars"></i>
								<input required="required" type="number" min="2" step="1" name="p1" value="2"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-columns"></i>
								<input required="required" type="number" min="2" step="1" name="p2" value="2"/>
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="name" placeholder="Game Name"/>
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="payoffs" placeholder="Space-separated values (top-left to bottom-right)"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addGameSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="addPlayersSection">
					<h3>Players</h3>
					<aside>
						Players in your experiment.
						To delete a player, just click the <i class="fa fa-remove"></i> symbol alongisde.
					</aside>
					<ul id="loadNewPlayers">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<aside>
						Add players to the game using this form.
						Players consist of e-mail addresses separated by white-space (newlines, tabs, spaces, whatever).
						Players will not be contacted until you start the game.
					</aside>
					<form action="@@cgibin@@/doaddplayers.json" method="post" id="addPlayers" onsubmit="return(addPlayers(this));">
						<div class="error">
							<div class="noshow" id="addPlayersErrSystem">
								An unexpected system error occurred.
							</div>
							<div class="noshow" id="addPlayersErrState">
								Experiment already started!
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-users"></i>
								<textarea required="required" name="players" placeholder="Space-separated player e-mail addresses..."></textarea>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addPlayersSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeMailSection">
					<h3>Change E-mail</h3>
					<aside>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangemail.json" method="post" id="changeMail" onsubmit="return(changeMail(this));">
						<div class="error">
							<div class="noshow" id="changeMailErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeMailErrForm">
								Invalid new or existing e-mail address.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email1" placeholder="Existing E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email2" placeholder="New E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeMailSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changePassSection">
					<h3>Change Password</h3>
					<aside>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangepass.json" method="post" id="changePass" onsubmit="return(changePass(this));">
						<div class="error">
							<div class="noshow" id="changePassErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changePassErrForm">
								Invalid new or existing password.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password1" placeholder="Existing Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password2" placeholder="New Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password3" placeholder="Repeat New Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changePassSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeSmtpSection">
					<h3>Change SMTP</h3>
					<aside>
						In order to send e-mails to players, you need to configure a valid e-mail sending
						service.
						If you mess up, you can always fix this information after the game starts and re-try e-mails
						that failed to send.
					</aside>
					<div id="checkSmtpResults" class="noshow">
						<h4>Current Values</h4>
						<aside>
							<div>
								The following are your SMTP parameters.
								Click <q>Send Test</q> to send a test message to the administrator account
								(<em>not</em> the <q>from address</q>!).
							</div>
						</aside>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input disabled="disabled" id="checkSmtpResultsServer" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input disabled="disabled" id="checkSmtpResultsUser" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input disabled="disabled" id="checkSmtpResultsFrom" type="text" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-send"></i>
								<button type="button" class="send" id="checkSmtpButton" onclick="testSmtp();">Send Test</button>
							</div>
						</fieldset>
					</div>
					<div id="testSmtpResults" class="noshow canclose">
						<h4>Results</h4>
						<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
						A test e-mail has been sent to <span id="testSmtpResultsMail"></span>.
						If you do not receive it in a little while, please fix your mail settings.
					</div>
					<div id="checkSmtpResultsNone" class="noshow error">
						<i class="fa fa-warning"></i>
						<span>You have not yet configured your e-mail server.</span>
					</div>
					<div id="checkSmtpResultsLoad">
						<i class="fa fa-spinner fa-spin"></i>
					</div>
					<aside>
						<div>
							The e-mail address <i class="fa fa-envelope"></i> will appear as the <q>from</q> address
							on all e-mails the system sends out.
							Make sure this is a real address so participants can write to you!
							The server <i class="fa fa-database"></i> is your SMTP server.
							It must be encrypted (SSL/TLS), and be in the form
							<q>smtp://the.server.name:port</q>, where the port is usually 25, 465, or 587.
							(It can be anything, though.)
							The username <i class="fa fa-user"></i> and password <i class="fa fa-lock"></i> are used
							to log into your server.
							<em>Your password is stored on the gamelab server</em>:
							make sure it's something random and not used elsewhere!
						</div>
					</aside>
					<form action="@@cgibin@@/dochangesmtp.json" method="post" id="changeSmtp" onsubmit="return(changeSmtp(this));">
						<div class="error">
							<div class="noshow" id="changeSmtpErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeSmtpErrForm">
								Invalid new or existing parameters.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email" placeholder="you@example.com"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input required="required" type="text" name="server" placeholder="smtp://example.com:587"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input required="required" type="text" name="user" placeholder="SMTP User"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password" placeholder="SMTP Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeSmtpSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@@htdocs@@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
