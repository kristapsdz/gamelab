<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@HTURI@/adminhome.css" type="text/css" />
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
		<script src="@HTURI@/script.js"></script>
		<script src="@HTURI@/adminhome.js"></script>
		<script>
			/*
			 * Replace the "login URL" identified in the
			 * experiment start section with the current URL
			 * having its admin bits replaced with lab bits.
			 */
			function onLoad() 
			{
				var url = document.URL;
				var e = document.getElementById('loginURI');

				if (null == e || null == url)
					return;

				url = url.substring(0, url.lastIndexOf("/"));
				url = url.replace('admin', 'lab');
				e.value = url + '/dologin.html';
			}
		</script>
	</head>
	<body onload="onLoad(); loadNewGames(); loadNewPlayers(); loadSmtp();" onclick="onNavUp();">
		<header>
			<a id="navButton" href="#" onclick="return(onNav(event));"><i class="fa fa-navicon"></i></a>
			<h1>gamelab</h1>
			<div id="exprCountdown">Not started</div>
			<div id="navParent">
				<nav id="nav">
					<a href="@ADMINURI@/dologout.html"><i class="fa fa-sign-out"></i> Logout</a>
				</nav>
			</div>
		</header>
		<article>
			<p>
				Welcome to <a href="http://www.kcons.eu/gamelab">gamelab</a> (version @VERSION@), the on-line game theory laboratory.
				To deploy an experiment, complete the form below.
				Use the on-line <a href="http://www.kcons.eu/gamelab/manual.html">manual</a> for help.
				Good luck!
			</p>
			<section>
				<section class="rolled" id="changePassSection">
					<h3 onclick="unroll(this.firstChild, this.parentNode);"><i class="fa fa-fw fa-chevron-circle-right"></i> 
						<span>1. Change Password</span>
					</h3>
					<div>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</div>
					<div class="noshow error" id="changePassErrSystem">
						An unexpected error occurred.
					</div>
					<div class="noshow error" id="changePassErrForm">
						Invalid new or existing password.
					</div>
					<form action="@ADMINURI@/dochangepass.json" method="post" id="changePass" onsubmit="return(changePass(this));">
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password1" placeholder="Existing Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password2" placeholder="New Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password3" placeholder="Repeat New Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changePassSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section class="rolled" id="changeMailSection">
					<h3 onclick="unroll(this.firstChild, this.parentNode);"><i class="fa fa-fw fa-chevron-circle-right"></i>
						<span>2. Change E-mail</span>
					</h3>
					<div>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</div>
					<div class="error noshow" id="changeMailErrSystem">
						An unexpected error occurred.
					</div>
					<div class="error noshow" id="changeMailErrForm">
						Invalid new or existing e-mail address.
					</div>
					<form action="@ADMINURI@/dochangemail.json" method="post" id="changeMail" onsubmit="return(changeMail(this));">
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email1" placeholder="Existing E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email2" placeholder="New E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeMailSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section class="rolled" id="changeSmtpSection">
					<h3 onclick="unroll(this.firstChild, this.parentNode);"><i class="fa fa-fw fa-chevron-circle-right"></i> 
						<span>3. Change SMTP</span>
						<i id="checkSmtpLoad2" class="fa fa-spinner"></i>
					</h3>
					<div>
						In order to send e-mails to players, you need to configure a valid e-mail sending
						service.
						If you mess up, you can always fix this information after the game starts and re-try e-mails
						that failed to send.
					</div>
					<div id="checkSmtpResults" class="noshow">
						<div>
							The following are your SMTP parameters.
							Click <q>Send Test</q> to send a test message to the administrator account
							(<em>not</em> the <q>from address</q>!).
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input disabled="disabled" id="checkSmtpResultsServer" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input disabled="disabled" id="checkSmtpResultsUser" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input disabled="disabled" id="checkSmtpResultsFrom" type="text" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-send"></i>
								<button type="button" class="send" id="checkSmtpButton" onclick="testSmtp();">Send Test</button>
							</div>
						</fieldset>
					</div>
					<div id="testSmtpResults" class="canclose noshow">
						<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
						<div>
							A test e-mail has been sent to <span id="testSmtpResultsMail"></span>.
							If you do not receive it in a little while, please fix your mail settings.
						</div>
					</div>
					<div>
						The e-mail address <i class="fa fa-envelope"></i> will appear as the <q>from</q> address
						on all e-mails the system sends out.
						Make sure this is a real address so participants can write to you!
						The server <i class="fa fa-database"></i> is your SMTP server.
						It must be encrypted (SSL/TLS), and be in the form
						<q>smtp://the.server.name:port</q>, where the port is usually 25, 465, or 587.
						(It can be anything, though.)
						The username <i class="fa fa-user"></i> and password <i class="fa fa-lock"></i> are used
						to log into your server.
						<em>Your password is stored on the gamelab server</em>:
						make sure it's something random and not used elsewhere!
					</div>
					<div class="error noshow" id="changeSmtpErrSystem">
						An unexpected error occurred.
					</div>
					<div class="error noshow" id="changeSmtpErrForm">
						Invalid new or existing parameters.
					</div>
					<form action="@ADMINURI@/dochangesmtp.json" method="post" id="changeSmtp" onsubmit="return(changeSmtp(this));">
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email" placeholder="you@example.com"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input required="required" type="text" name="server" placeholder="smtp://example.com:587"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input required="required" type="text" name="user" placeholder="SMTP User"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password" placeholder="SMTP Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeSmtpSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section class="rolled" id="addGameSection">
					<h3 onclick="unroll(this.firstChild, this.parentNode);"><i class="fa fa-fw fa-chevron-circle-right"></i> 
						<span>4. Games</span>
					       	<i id="checkGameLoad2" class="fa fa-spinner"></i>
					</h3>
					<div>
						The following are your games.
						To delete a game, click the <i class="fa fa-remove"></i> symbol alongside.
					</div>
					<ul id="loadGames">
						<li><i class="fa fa-spinner"></i></li>
					</ul>
					<div>
						You may add games by specifying a name and payoffs.
						Payoffs must follow the usual top-left to bottom-right order, one payoff per player (row player first).
					</div>
					<div class="error noshow" id="addGameErrSystem">
						An unexpected system error occurred.
					</div>
					<div class="error noshow" id="addGameErrForm">
						Invalid game payoffs, name, or strategy count.
					</div>
					<div class="error noshow" id="addGameErrState">
						Experiment already started!
					</div>
					<form action="@ADMINURI@/doaddgame.json" method="post" id="addGame" onsubmit="return(addGame(this));">
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-bars"></i>
								<input required="required" type="number" min="2" step="1" name="p1" value="2"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-columns"></i>
								<input required="required" type="number" min="2" step="1" name="p2" value="2"/>
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="name" placeholder="Game Name"/>
							</div>
							<div class="input">
								<i class="fa fa-fw"></i>
								<input required="required" type="text" name="payoffs" placeholder="Space-separated values (top-left to bottom-right)"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addGameSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section class="rolled" id="addPlayersSection">
					<h3 onclick="unroll(this.firstChild, this.parentNode);"><i class="fa fa-fw fa-chevron-circle-right"></i> 
						<span>5. Players</span>
						<i id="checkPlayersLoad2" class="fa fa-spinner"></i>
					</h3>
					<div>
						Players in your experiment.
						To delete a player, just click the <i class="fa fa-remove"></i> symbol alongisde.
						Players offset with <i class="fa fa-globe"></i> were auto-added.
					</div>
					<ul id="loadNewPlayers">
						<li><i class="fa fa-spinner"></i></li>
					</ul>
					<div>
						Add players to the game using this form.
						Players consist of e-mail addresses separated by white-space (newlines, tabs, spaces, whatever).
						If you set the <q>Auto-Add</q> toggle, then players may add themselves.
						Auto-added players will not be e-mailed when the experiment is started; manually-added players
						will be mailed.
					</div>
					<div class="error noshow" id="addPlayersErrSystem">
						An unexpected system error occurred.
					</div>
					<div class="error noshow" id="addPlayersErrState">
						Experiment already started!
					</div>
					<form action="@ADMINURI@/doaddplayers.json" method="post" id="addPlayers" onsubmit="return(addPlayers(this));">
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-users"></i>
								<textarea name="players" placeholder="Space-separated player e-mail addresses..."></textarea>
							</div>
							<div class="input input-check">
								<i onclick="toggler('autoadd', 'autoaddToggle');" id="autoaddToggle" class="fa fa-fw fa-toggle-off"></i>
								<span onclick="toggler('autoadd', 'autoaddToggle');">Self-Adding Players</span>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="addPlayersSubmit" type="submit" value="Submit" />
							</div>
							<input type="hidden" id="autoadd" name="autoadd" value="0" />
						</fieldset>
					</form>
				</section>
				<section class="rolled" id="startExprSection">
					<h3 onclick="unroll(this.firstChild, this.parentNode);"><i class="fa fa-fw fa-chevron-circle-right"></i> 
						<span>6. Experiment Parameters</span>
					</h3>
					<div>
						Commit your experiment parameters and start here.
						Once you start your experiment, you can't reconfigure.
					</div>
					<div>
						You'll need to enter the <i class="fa fa-link"></i> address for logging in (sent in players'
						welcome email &mdash; you probably don't want to change this), the <i class="fa
							fa-calendar"></i> start date and <i class="fa fa-clock-o"></i> time in GMT
						<script>
							var now = new Date();
							document.write('(' + (now.getTimezoneOffset() / 60) + ' hours)');
						</script>, the
						<i class="fa fa-gears"></i> number of rounds, and the <i class="fa fa-history"></i> minutes per round.
						You can also change the <i class="fa fa-code"></i> instructions (in HTML5 markup) that
						will be shown to players.
					</div>
					<div class="error">
						<div class="noshow" id="startExprErrSystem">
							An unexpected error occurred.
						</div>
						<div class="noshow" id="startExprErrForm">
							Can't start: start date in the past, not enough days, no e-mail setup, or no no participants or games.
						</div>
						<div class="noshow" id="startExprErrState">
							Experiment already started!
						</div>
					</div>
					<form action="@ADMINURI@/dostartexpr.json" method="post" id="startExpr" onsubmit="return(startExpr(this));">
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-link"></i>
								<input required="required" id="loginURI" type="url" name="uri" />
							</div>
							<span class="inputheader">
								Current GMT date:
								<script>
									var now = new Date();
									document.write
										(now.getUTCFullYear() + '-' +
										 ('0' + (now.getUTCMonth()+1)).slice(-2) + '-' +
										 ('0' + now.getUTCDate()).slice(-2));
								</script>
							</span>
							<div class="input">
								<i class="fa fa-fw fa-calendar"></i>
								<input required="required" id="date" type="date" name="date" placeholder="yyyy-mm-dd" />
							</div>
							<span class="inputheader">
								Current GMT time: 
								<script>
									var now = new Date();
									document.write
										(('0' + now.getUTCHours()).slice(-2) + ':' +
										 ('0' + now.getUTCMinutes()).slice(-2));
								</script>
							</span>
							<div class="input">
								<i class="fa fa-fw fa-clock-o"></i>
								<input required="required" id="time" type="time" name="time" placeholder="hh:mm GMT" />
							</div>
							<span>
								...or start in 
								<a href="#" onclick="exprStartTime(60 * 1000); return false;">one minute</a>, 
								<a href="#" onclick="exprStartTime(60 * 10 * 1000); return false;">ten minutes</a>, 
								<a href="#" onclick="exprStartTime(60 * 60 * 1000); return false;">one hour</a>, or
								<a href="#" onclick="exprStartTime(24 * 60 * 60 * 1000); return false;">one day</a> from now.
							</span>
							<div class="input">
								<i class="fa fa-fw fa-gears"></i>
								<input required="required" type="number" name="rounds" min="1" step="1" value="14" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-history"></i>
								<input required="required" type="number" name="minutes" max="1440" min="1" step="1" value="1440" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-code"></i>
								<textarea id="instrText" class="bigtext" required="required" name="instr"><p>Welcome to the experiment!</p>

<p>
You are participating in an experiment in which you will use this web page to play a number of games. 
Depending on your own and others' choices you can earn a substantial amount of money by winning a lottery at the end of the experiment. 
Your chances to win the lottery depend in
part on how well you understand these instructions, so read them carefully.
</p>
<p>
Below you will find all the information you need to participate. Feel free to contact <a
	       href="mailto:@@gamelab-admin-email@@">@@gamelab-admin-email@@</a> if you have any additional questions.
</p>
<h3>Experimental overview</h3>
<p>
The experiment is divided into @@gamelab-rounds@@ rounds and each round is open during @@gamelab-round-time@@ hours. 
In each round you play @@gamelab-games@@ games. 
These games are the same in all rounds.
</p>
<p>
In all games you have the opportunity to get payoffs depending how you and others play. 
Your payoffs are calculated as soon as a round closes, given that you have played all @@gamelab-games@@ games in the round.
</p>
<p>
When a new round begins you can view your payoffs from the previous round directly on the <q>Play</q> tab.
A more detailed summary of your payoffs for each game from all previous rounds, along with the total sum of your payoffs, is available on the
<q>History</q> tab.
</p>
<h3>Game setup</h3>
<p>
Each game is represented in a game bimatrix (a table) where one player chooses row and the other column. 
You are a row player in all games and rounds. 
Your payoff is the first number in each cell and will always have the color of this box: <i class="gamelab-colour fa fa-square"></i>.
The column player's payoff is the second number in each cell and will always have the color of this box: <i class="gamelab-ocolour fa
	fa-square"></i>.
</p>
<p>
When you play you may either select a pure strategy (one row) or a mixed strategy (a probability distribution over the rows). 
In the first case, you assign probability one to the row you want to play. 
In the second case, you select positive probabilities for multiple rows, as long as they sum to one. 
Your choice of strategy is your private information and is never shared with any other participant.
</p>
<p>
When you have decided on a strategy (pure or mixed), click on each row that is included in your strategy and assign the corresponding probability in the input field. 
Any row that you don't select will be assigned probability zero. 
Once this is done, click the <q>Submit Play</q> button to submit your play.
</p>
<p>
After you have submitted your play, click the <q>Go to next game</q> button to proceed to the next game.
</p>
<h3>Payoffs</h3>
<p>
After each round, you are matched against all column players and your strategy is played against each of their strategies. 
In each game, you are given the average payoff of your strategy against all column players.
</p>
<p>
Your final payoff from a round is calculated as the sum of your payoffs from all @@gamelab-games@@ games. 
Your overall payoff in the experiment is the sum of your final payoffs from all rounds.
</p>
<p>
You can view information about your previous payoffs at the <q>History</q> tab at any time.
</p>
<h3>Lottery tickets and picking the winner</h3>
<p>
At the end of the experiment your overall payoff is transformed into the equivalent number of lottery tickets. 
(Should your overall payoff be a non-integer number, we will round off upwards.) 
Each lottery ticket will be assigned a unique number. Out of all tickets to all participants in the experiment, one lottery ticket will be
randomly drawn to win a prize of 10 000 SEK.
</p>
<p>
In drawing the winning ticket, we will use the Swedish Lotto system.
More exactly, we will use a quasi-random process in which an initial seed determines the winning number (the exact code is available upon request). 
To make sure that the initial seed is completely random it will be determined by a random draw by a third party. 
More precisely, the seed will be the <q>Tilläggsnummer</q> from the first <q><a target="_blank" 
		href="https://svenskaspel.se/?pageid=/resultat/lottolordag">Lotto 1</a></q> draw after the final round of the experiment.
</p>
<p>
Once the initial seed is drawn, the winning lottery ticket will be computed and the winner will be contacted.
</p>
<h3>History of play</h3>
<p>
You can view how a game was played in the previous round by looking at the history table directly on the <q>Play</q> tab when playing that game. 
A full summary of play in all previous rounds is available on the <q>History</q> tab.
</p>
<p>
The history table summarizes how players in both roles (including you) have played in the previous round. 
The number in the white cells in the matrix shows the share of plays that ended in that cell in the last round. 
The first number in the gray cells shows in what share of plays that row or column strategy was used. 
The number in brackets in the gray cells to the right show your payoff, represented by [U], should you have played the pure strategy
associated with each row in the previous round.
</p>
<p>
An example of a history table:
</p>
<div class="history" style="max-width: 20em;">
  <div>
    <div style="width: 1%;" class="labelaside"></div>
    <div style="width: 32%;" class="labelatop">A</div>
    <div style="width: 32%;" class="labelatop">B</div>
    <div style="width: 32%;" class="sumaside">&#x2211; [<span class="gamelab-colour">U</span>]</div>
  </div>
  <div>
    <div class="labelatop">a</div>
    <div class="mix">0.315</div>
    <div class="mix">0.585</div>
    <div class="sumaside sum">0.900 [<span class="gamelab-colour">U</span>]</div>
  </div>
  <div>
    <div class="labelatop">b</div>
    <div class="mix">0.035</div>
    <div class="mix">0.065</div>
    <div class="sumaside sum">0.100 [<span class="gamelab-colour">U</span>]</div>
  </div>
  <div>
    <div class="labelaside">&#x2211;</div>
    <div class="sumbelow sum">0.350</div>
    <div class="sumbelow sum">0.650</div>
    <div class="sumaside"></div>
  </div>
</div>
<p>
From the history table we see that the share of plays ending in the combination <q>a</q> and <q>A</q> was 0.315 in the last round while the
share of plays ending in <q>a</q> and <q>B</q> was 0.585. 
Looking at the numbers in the gray cells we see that the share of plays in which row players played <q>a</q> was 0.9, and the share in which
column players played <q>B</q> was 0.650.
</p></textarea>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-code"></i>
								<textarea id="instrWinText" required="required" name="instrWin">
This means that you have won prize number <span id="exprFinishedWinRank"></span>!
You will be contacted by the experimenter shortly.</textarea>
							</div>
							<!-- div class="input input-submit">
								<i class="fa fa-save"></i>
								<input id="startExprSubmit" type="submit" name="submit" value="Save" gamelab-submit-pending="Saving..." />
							</div -->
							<div class="input input-submit">
								<i class="fa fa-check"></i>
								<input id="startExprSubmit" type="submit" name="submit" value="Start" gamelab-submit-pending="Starting..." />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 2015
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@HTURI@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
