<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab | Participant Login</title>
		<link rel="stylesheet" href="@HTURI@/style.css" type="text/css" />
		<link rel="stylesheet" href="@HTURI@/playerlogin.css" type="text/css" />
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
		<script src="@HTURI@/script.js"></script>
		<script>
			function doRegErr(err) 
			{

				doValue('registering', 'Register');
				switch (err) {
				case (400):
					doUnhide('registerError');
					break;
				case (403):
					doUnhide('registerAgainError');
					break;
				case (404):
					doUnhide('registerNoAutoError');
					break;
				case (409):
					doUnhide('registerStartedError');
					break;
				default:
					doUnhide('registerSysError');
					break;
				}
			}

			function doLogErr(err) 
			{

				doValue('loggingin', 'Login');
				doUnhide(400 == err ? 'loginError' : 'loginSysError');
			}

			function doLogOk() 
			{

				doValue('loggingin', 'Success! Redirecting...');
				location.href = '@HTURI@/playerhome.html';
			}

			function doRegOk(resp) 
			{
				var res;

				doHide('registerSection');
				doUnhide('loginSection');

				try {
					res = JSON.parse(resp);
				} catch (error) {
					doUnhide('loginsSysErr');
					return;
				}

				doValue('email', res.email);
				doValue('password', res.password);
				console.log('Set ' + res.email + ' with ' + res.password + '.');
			}

			function doLogSetup() 
			{

				doHide('loginError');
				doHide('loginSysError');
				doValue('registering', 'Logging in...');
			}

			function doRegSetup() 
			{

				doHide('registerError');
				doHide('registerSysError');
				doValue('registering', 'Registering...');
			}
		</script>
	</head>
	<body id="login">
		<article>
			<section>
				<h1>gamelab</h1>
				<form autocomplete="off" action="@LABURI@/doautoadd.json" method="post" 
					id="registerSection" onsubmit="return(sendForm(this, doRegSetup, doRegErr, doRegOk));">
					<section>
						<h3>Participant Auto-Login</h3>
						<div class="error">
							<div class="noshow" id="registerError">
								Invalid e-mail address.
							</div>
							<div class="noshow" id="registerAgainError">
								A participant by that e-mail address already exists.
								Please talk to the proctor if you accidentally closed the gamelab window!
							</div>
							<div class="noshow" id="registerNoAutoError">
								Experiment does not allow auto-registration.
								Please talk to the proctor to register!
							</div>
							<div class="noshow" id="registerStartedError">
								Experiment has already started!
							</div>
							<div class="noshow" id="registerSysError">
								A technical error has occured.
							</div>
						</div>
						<fieldset>
							<div class="input input-email">
								<i class="fa fa-fw fa-envelope"></i>
								<input autofocus="autofocus" type="email" placeholder="E-mail Address" required="required" name="email" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="registering" type="submit" value="Register" />
							</div>
						</fieldset>
					</section>
					<section>
						To use gamelab, you must have an up-to-date browser such as <a
							href="http://www.getfirefox.org">Firefox</a> or <a
							href="http://www.google.com/chrome">Chrome</a> with cookies and JavaScript enabled.
					</section>
				</form>
				<form class="noshow" action="@LABURI@/dologin.json" method="post" 
					id="loginSection" onsubmit="return(sendForm(this, doLogSetup, doLogErr, doLogOk));">
					<section>
						<h3>Participant Auto-Login</h3>
						<div class="error">
							<div class="noshow" id="loginError">Experiment hasn't started yet!</div>
							<div class="noshow" id="loginSysError">A technical error has occured.</div>
						</div>
						<fieldset>
							<input type="hidden" id="email" name="email" />
							<input type="hidden" id="password" name="password" />
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="loggingin" type="submit" value="Login" />
							</div>
						</fieldset>
					</section>
					<section>
						You have been registered.
						Please click the <q>Login</q> button when the proctor begins the game.
						To use gamelab, you must have an up-to-date browser such as <a
							href="http://www.getfirefox.org">Firefox</a> or <a
							href="http://www.google.com/chrome">Chrome</a> with cookies and JavaScript enabled.
					</section>
				</form>
			</section>
		</article>
		<footer>
			<a href="http://www.kcons.eu/gamelab">gamelab</a>
			&copy; 2014&ndash;2015
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@HTURI@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
