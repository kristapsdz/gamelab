<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@@htdocs@@/style.css" type="text/css" />
		<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
		<style>
			nav li:first-child { background-color: red; }
			h1 { color: #fff; }
		</style>
		<script src="@@htdocs@@/script.js"></script>
		<script src="@@cgibin@@/home.js"></script>
	</head>
	<body onload="loadGames(); loadPlayers(); loadExpr(); loadSmtp();">
		<header>
			<nav>
				<ul>
					<li><h1>Administrator</h1></li>
					<li>
						<a href="@@cgibin@@/dologout.html"><i class="fa fa-sign-out"></i>Logout</a>
					</li>
				</ul>
			</nav>
		</header>
		<article>
			<section>
				<div id="statusExprTtl"></div>
				<section id="statusExpr">
					<h3>Run Status</h3>
					<div id="statusExprProgress"></div>
					<div id="statusExprWaiting">
						Waiting for experiment to begin.
					</div>
					<div id="statusExprLoading">
						<i class="fa fa-spinner fa-spin"></i>
					</div>
				</section>
				<section>
					<h3>Experiment Games</h3>
					<ul id="loadGames">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
				</section>
				<section>
					<h3>Experiment Players</h3>
					<aside>
						Players in your experiment.
						To disable a player, just click the <i class="fa fa-remove"></i> symbol alongisde.
						To enable a player, use the <i class="fa fa-plus"></i> symbol.
						Row players are noted with <i class="fa fa-bars"></i>, column players with
						<i class="fa fa-columns"></i>.
					</aside>
					<ul id="loadPlayers">
						<li><i class="fa fa-spinner fa-spin"></i></li>
					</ul>
					<div id="playerInfo" class="canclose noshow">
						<h4>Player Status</h4>
						<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
						<span id="playerInfoEmail"></span>: 
						<span id="playerInfoStatus"></span>, 
						<span id="playerInfoEnabled"></span>
					</div>
					<fieldset>
						<div class="input input-submit">
							<i class="fa fa-send"></i>
							<button class="send" id="recheckSmtpButton" onclick="reTestSmtp();">Resend Mails</button>
						</div>
					</fieldset>
				</section>
			</section>
			<section>
				<section id="changeMailSection">
					<h3>Change E-mail</h3>
					<aside>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangemail.json" method="post" id="changeMail" onsubmit="return(changeMail(this));">
						<div class="error">
							<div class="noshow" id="changeMailErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeMailErrForm">
								Invalid new or existing e-mail address.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email1" placeholder="Existing E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email2" placeholder="New E-mail"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope-o"></i>
								<input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeMailSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changePassSection">
					<h3>Change Password</h3>
					<aside>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangepass.json" method="post" id="changePass" onsubmit="return(changePass(this));">
						<div class="error">
							<div class="noshow" id="changePassErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changePassErrForm">
								Invalid new or existing password.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password1" placeholder="Existing Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password2" placeholder="New Password"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password3" placeholder="Repeat New Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changePassSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
				<section id="changeSmtpSection">
					<h3>Change SMTP</h3>
					<aside>
						In order to send e-mails to players, you need to configure a valid e-mail sending
						service.
						Click <q>Send Test</q> to send a test message to the administrator account.
					</aside>
					<div id="checkSmtpResults" class="noshow">
						<h4>Current Values</h4>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input disabled="disabled" id="checkSmtpResultsServer" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input disabled="disabled" id="checkSmtpResultsUser" type="text" />
							</div>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input disabled="disabled" id="checkSmtpResultsFrom" type="text" />
							</div>
							<div class="input input-submit">
								<i class="fa fa-send"></i>
								<button class="send" id="checkSmtpButton" onclick="testSmtp();">Send Test</button>
							</div>
						</fieldset>
					</div>
					<div id="testSmtpResults" class="noshow canclose">
						<h4>Results</h4>
						<a href="#" class="close" onclick="doHideNode(this.parentNode); return false;"><i class="fa fa-minus-square"></i></a>
						A test e-mail has been sent to <span id="testSmtpResultsMail"></span>.
						If you do not receive it in a little while, please fix your mail settings.
					</div>
					<div id="checkSmtpResultsNone" class="noshow">
						<i class="fa fa-warning"></i>
						<span>You have not yet configured your e-mail server.</span>
					</div>
					<div id="checkSmtpResultsLoad">
						<i class="fa fa-spinner fa-spin"></i>
					</div>
					<aside>
						Fill in the <q>From Address</q> (which appears on all e-mails to players), <q>SMTP
							Server</q> to a valid SSL-secured SMTP server, <q>SMTP User</q> to the your
						server account name, and <q>SMTP Password</q> to the your user's password.
					</aside>
					<form action="@@cgibin@@/dochangesmtp.json" method="post" id="changeSmtp" onsubmit="return(changeSmtp(this));">
						<div class="error">
							<div class="noshow" id="changeSmtpErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeSmtpErrForm">
								Invalid new or existing parameters.
							</div>
						</div>
						<fieldset>
							<div class="input">
								<i class="fa fa-fw fa-envelope"></i>
								<input required="required" type="email" name="email" placeholder="you@example.com"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-database"></i>
								<input required="required" type="text" name="server" placeholder="smtp://example.com:587"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-user"></i>
								<input required="required" type="text" name="user" placeholder="SMTP User"/>
							</div>
							<div class="input">
								<i class="fa fa-fw fa-lock"></i>
								<input required="required" type="password" name="password" placeholder="SMTP Password"/>
							</div>
							<div class="input input-submit">
								<i class="fa fa-fw fa-check"></i>
								<input id="changeSmtpSubmit" type="submit" value="Submit" />
							</div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@@htdocs@@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
