<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<meta charset="utf-8" /> 
		<title>Gamelab Administration</title>
		<link rel="stylesheet" href="@@cgibin@@/style.css" type="text/css" />
		<script src="@@htdocs@@/script.js"></script>
		<script src="@@cgibin@@/home.js"></script>
	</head>
	<body onload="loadGames(); loadPlayers(); loadExpr(); loadSmtp();">
		<header>
			<nav>
				<ul>
					<li><h1>Administrator</h1></li>
					<li><a href="@@cgibin@@/dologout.html"><img src="@@htdocs@@/logout.png" alt="Logout" class="logout" /></a></li>
				</ul>
			</nav>
		</header>
		<article>
			<section>
				<div id="statusExprTtl"></div>
				<section id="statusExpr">
					<h3>Run Status</h3>
					<div id="statusExprProgress"></div>
					<div id="statusExprWaiting">
						Waiting for experiment to begin.
					</div>
					<div id="statusExprLoading">
						<span class="loading">Loading...</span>
					</div>
				</section>
				<section>
					<h3>Experiment Games</h3>
					<ul id="loadGames">
						<li><span class="loading">Loading...</span></li>
					</ul>
				</section>
				<section>
					<h3>Experiment Players</h3>
					<aside>
						Players in your experiment.
						If a player is greyed out, he or she is disabled (not allowed to participate).
						To disable a player, just click the red symbol alongisde.
						To enable a player, use the green symbol.
					</aside>
					<ul id="loadPlayers">
						<li><span class="loading">Loading...</span></li>
					</ul>
					<div class="noshow" id="playerInfo" class="canclose">
						<h4>Player Status</h4>
						<img class="close" src="@@htdocs@@/disable.png" alt="Close" onclick="doHideNode(this.parentNode)" />
						<span id="playerInfoEmail"></span>: 
						<span id="playerInfoStatus"></span>, 
						<span id="playerInfoEnabled"></span>
					</div>
				</section>
			</section>
			<section>
				<section id="changeMailSection">
					<h3>Change E-mail</h3>
					<aside>
						You should set the e-mail address to your address, as the system (or system administrator) will
						mail you if it has issues.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangemail.json" method="post" id="changeMail" onsubmit="return(changeMail(this));">
						<div class="error">
							<div class="noshow" id="changeMailErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeMailErrForm">
								Invalid new or existing e-mail address.
							</div>
						</div>
						<fieldset>
							<div><input required="required" type="email" name="email1" placeholder="Existing E-mail"/></div>
							<div><input required="required" type="email" name="email2" placeholder="New E-mail"/></div>
							<div><input required="required" type="email" name="email3" placeholder="Repeat New E-mail"/></div>
							<div><input id="changeMailSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
				<section id="changePassSection">
					<h3>Change Password</h3>
					<aside>
						Set your password (at least one character) here.
						You should do this when you first use the system, as the default is too easy.
						It's up to you to make sure your password is secure.
						You will be logged out after doing so.
					</aside>
					<form action="@@cgibin@@/dochangepass.json" method="post" id="changePass" onsubmit="return(changePass(this));">
						<div class="error">
							<div class="noshow" id="changePassErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changePassErrForm">
								Invalid new or existing password.
							</div>
						</div>
						<fieldset>
							<div><input required="required" type="password" name="password1" placeholder="Existing Password"/></div>
							<div><input required="required" type="password" name="password2" placeholder="New Password"/></div>
							<div><input required="required" type="password" name="password3" placeholder="Repeat New Password"/></div>
							<div><input id="changePassSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
				<section id="changeSmtpSection">
					<h3>Change SMTP</h3>
					<aside>
						In order to send e-mails to players, you need to configure a valid e-mail sending
						service.
						Click <q>Send Test</q> to send a test message to the administrator account.
					</aside>
					<div id="checkSmtpResults" class="noshow">
						<ul>
							<li><span>SMTP server: <span id="checkSmtpResultsServer"></span></span></li>
							<li><span>SMTP user: <span id="checkSmtpResultsUser"></span></span></li>
							<li><span>From address: <span id="checkSmtpResultsFrom"></span></span></li>
						</ul>
						<div><button class="send" id="checkSmtpButton" onclick="testSmtp();">Send Test</button></div>
					</div>
					<div id="testSmtpResults" class="noshow canclose">
						<h4>Results</h4>
						<img class="close" src="@@htdocs@@/disable.png" alt="Close" onclick="doHideNode(this.parentNode)" />
						A test e-mail has been sent to <span id="testSmtpResultsMail"></span>.
						If you do not receive it in a little while, please fix your mail settings.
					</div>
					<div id="checkSmtpResultsNone" class="noshow">
						<ul>
							<li><span>You have not yet configured your e-mail server.</span></li>
						</ul>
					</div>
					<div id="checkSmtpResultsLoad">
						<ul>
							<li><span><span class="loading">Loading...</span></span></li>
						</ul>
					</div>
					<aside>
						Fill in the <q>From Address</q> (which appears on all e-mails to players), <q>SMTP
							Server</q> to a valid SSL-secured SMTP server, <q>SMTP User</q> to the your
						server account name, and <q>SMTP Password</q> to the your user's password.
					</aside>
					<form action="@@cgibin@@/dochangesmtp.json" method="post" id="changeSmtp" onsubmit="return(changeSmtp(this));">
						<div class="error">
							<div class="noshow" id="changeSmtpErrSystem">
								An unexpected error occurred.
							</div>
							<div class="noshow" id="changeSmtpErrForm">
								Invalid new or existing parameters.
							</div>
						</div>
						<fieldset>
							<div><input required="required" type="email" name="email" placeholder="you@example.com"/></div>
							<div><input required="required" type="text" name="server" placeholder="smtp://example.com:587"/></div>
							<div><input required="required" type="text" name="user" placeholder="SMTP User"/></div>
							<div><input required="required" type="password" name="password" placeholder="SMTP Password"/></div>
							<div><input id="changeSmtpSubmit" type="submit" value="Submit" /></div>
						</fieldset>
					</form>
				</section>
			</section>
		</article>
		<footer>
			&copy; 2014, 
			<a href="http://www.kcons.eu"><i>k</i>-Consulting</a>
			<a href="@@htdocs@@/privacy.html">Privacy</a>
		</footer>
	</body>
</html>
